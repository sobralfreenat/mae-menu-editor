<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FNW - M.A.E. Editor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 25px;
            border: 1px solid #ccc;
            border-radius: 5px;
            max-width: 600px;
        }
		
		h3, h6, h5 {
            margin: 8px;
        }
        input, textarea, select {
            width: 100%;
            margin-bottom: 10px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        select {
            background-color: gold;
        }
        button {
            padding: 10px 15px;
            background-color: #f7f6a3 !important;
            color: #19262b !important;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: darkgray !important;
        }
        .entry {
            cursor: move;
            margin: 5px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .entry:hover {
            background-color: #f1f1f1;
        }
        .tooltip {
            position: relative;
            display: inline-block;
        }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 450px;
            background-color: #555;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 5px 0;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -20px;
            opacity: 0.2;
            transition: opacity 0.4s;
        }
        .tooltip:hover .tooltiptext {
            visibility: visible;
			background-color: Black;
            opacity: 1;
		}
        .copy-button {
            background-color: black !important;
            color: white !important;
			font-size: 17px;
        }
        .copy-button:hover {
            background-color: blue !important;
        }
        .entry.sortable-ghost {
            opacity: 0.4;
        }
        .entry.sortable-drag {
            opacity: 0.8;
        }
        .reorder-button {
            background-color: black !important;
            color: white !important;
        }
		
		
        .button-container {
            display: flex;
            justify-content: center;
            padding: 20px 0;
        }

		#saveButton {
            background-color: darkgreen !important;
            color: white !important;
            font-size: 14px;
            padding: 15px 23px;
            border-radius: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.4);
        }
        #saveButton:hover {
            background-color: #45a049 !important;
        }

    </style>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
</head>
<body>

<h3>M.A.E. Menu Editor</h3> 
<h6>Versão 1.9  - FNW ASsessoria Digital  - Alex Sobral 2024</h6> 
<h5>Importar / Editar / Gerar / Salvar : <space>    </space>
<button class="button" onclick="abrirOuFocarJanela('https://sobralfreenat.github.io/mae-menu-editor-instru-es/', 'Instruções')">Abrir Instruções</button>

<button class="button" onclick="abrirOuFocarJanela('https://freenat-doc.systeme.io/aducation-clientes-equipes', 'M.A.E.', 280, 900, 320, 100)">Abrir - M.A.E.</button>
<br><br>

<input type="file" id="fileInput" accept=".json">
<button id="loadButton">Carregar JSON</button><br><br>
<button id="copyFileNameButton" class="copy-button" style="display:none;">Clique para Copiar Nome do Arquivo - pressione a tecla [Windows]<br> e control+V e [Enter]</button><br><br>

<div class="tooltip">
    <label for="id">ID:</label>
    <span class="tooltiptext">Exemplo: "mae-start".<br>Digite um ID único para cada entrada.</span>
</div>
<input type="text" id="id" placeholder="Digite um ID único">
<div class="tooltip">
    <label for="categoria">Categoria:</label>
    <span class="tooltiptext">Exemplo: "M.A.E.".<br>Digite a categoria da entrada.</span>
</div>
<input type="text" id="categoria" placeholder="Digite a categoria">
<div class="tooltip">
    <label for="assunto">Assunto:</label>
    <span class="tooltiptext">Exemplo: "Início do Curso".<br>Digite o título ou assunto da entrada.</span>
</div>
<input type="text" id="assunto" placeholder="Digite o assunto">
<div class="tooltip">
    <label for="descricao">Descrição:</label>
    <span class="tooltiptext">Exemplo: "Descrição breve do curso".<br>Digite uma descrição detalhada.</span>
</div>
<textarea id="descricao" placeholder="Digite a descrição"></textarea>
<div class="tooltip">
    <label for="url">URL:</label>
    <span class="tooltiptext">Exemplo: "https://exemplo.com".<br>Digite a URL relacionada à entrada.</span>
</div>
<input type="text" id="url" placeholder="Digite a URL">
<div>
    <label for="actionType">Ação:</label>
    <select id="actionType">
        <option value="add">Adicionar</option>
        <option value="replace">Substituir</option>
    </select>
</div>
<button id="addButton">Adicionar/Modificar</button>
<button id="reorderButton" class="reorder-button">Ativar Reordenação</button>


<h2>Resultado:</h2>
<div id="outputJson"></div>


<button id="saveButton">Salvar JSON</button>
<script>
    const entries = {};
    let loadedFileName = '';
    let editingId = null;
    let isReordering = false;
    let sortable;

    document.getElementById('addButton').addEventListener('click', function() {
        const id = document.getElementById('id').value.trim();
        const categoria = document.getElementById('categoria').value.trim();
        const assunto = document.getElementById('assunto').value.trim();
        const descricao = document.getElementById('descricao').value.trim();
        const url = document.getElementById('url').value.trim();
        const actionType = document.getElementById('actionType').value;

        if (!id || !categoria || !assunto || !descricao || !url) {
            alert('Por favor, preencha todos os campos.');
            return;
        }

        if (actionType === 'replace') {
            entries[id] = {
                title: assunto,
                description: descricao,
                url: url,
                category: categoria
            };
        } else {
            if (!entries[id]) {
                entries[id] = {
                    title: assunto,
                    description: descricao,
                    url: url,
                    category: categoria
                };
            } else {
                alert('ID já existe. Para substituir, selecione "Substituir" na ação.');
            }
        }

        displayEntries();
        clearFields();
    });

    document.getElementById('saveButton').addEventListener('click', function() {
    const fileName = loadedFileName || 'dados.json';
    const newFileName = prompt('Digite o nome do arquivo (sem extensão):', fileName.replace('.json', '')) || 'dados';
    
    // Cria um novo objeto com a ordem atual
    const orderedEntries = {};
    const outputDiv = document.getElementById('outputJson');
    const entryDivs = outputDiv.querySelectorAll('.entry');
    
    entryDivs.forEach(div => {
        const id = div.getAttribute('data-id');
        orderedEntries[id] = entries[id];
    });

    const blob = new Blob([JSON.stringify(orderedEntries, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${newFileName}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
});

    document.getElementById('loadButton').addEventListener('click', function() {
        const fileInput = document.getElementById('fileInput');
        const file = fileInput.files[0];
        
        if (!file) {
            alert('Por favor, selecione um arquivo JSON para carregar.');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(event) {
            try {
                const loadedEntries = JSON.parse(event.target.result);
                Object.assign(entries, loadedEntries);
                loadedFileName = file.name;
                displayEntries();
                document.getElementById('copyFileNameButton').style.display = 'inline';
            } catch (error) {
                alert('Erro ao carregar o arquivo: ' + error);
            }
        };
        reader.readAsText(file);
    });

    document.getElementById('copyFileNameButton').addEventListener('click', function() {
        navigator.clipboard.writeText(loadedFileName).then(() => {
            alert('Nome do arquivo copiado: ' + loadedFileName);
        }, (err) => {
            console.error('Erro ao copiar: ', err);
        });
    });

    document.getElementById('reorderButton').addEventListener('click', toggleReordering);

    function toggleReordering() {
        isReordering = !isReordering;
        const outputDiv = document.getElementById('outputJson');
        const reorderButton = document.getElementById('reorderButton');
        
        if (isReordering) {
            sortable = new Sortable(outputDiv, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                dragClass: 'sortable-drag',
                onEnd: function(evt) {
                    const itemEl = evt.item;
                    const newIndex = evt.newIndex;
                    const id = itemEl.getAttribute('data-id');
                    reorderEntries(id, newIndex);
                }
            });
            reorderButton.textContent = 'Desativar Reordenação';
        } else {
            if (sortable) {
                sortable.destroy();
            }
            reorderButton.textContent = 'Ativar Reordenação';
        }
        
        displayEntries();
    }

    function displayEntries() {
        const outputDiv = document.getElementById('outputJson');
        outputDiv.innerHTML = '';
        const sortedEntries = Object.keys(entries);

        sortedEntries.forEach(id => {
            const entry = entries[id];
            const div = document.createElement('div');
            div.className = 'entry';
            div.setAttribute('data-id', id);
            div.innerHTML = `
                <span>ID: ${id}, Título: ${entry.title}, Categoria: ${entry.category}</span>
                <button onclick="editEntry('${id}')">Editar</button>
                <button onclick="deleteEntry('${id}')">Deletar</button>
            `;
            outputDiv.appendChild(div);
        });
    }

    function clearFields() {
        document.getElementById('id').value = '';
        document.getElementById('categoria').value = '';
        document.getElementById('assunto').value = '';
        document.getElementById('descricao').value = '';
        document.getElementById('url').value = '';
        document.getElementById('actionType').value = 'add';
    }

    function editEntry(id) {
        const entry = entries[id];
        document.getElementById('id').value = id;
        document.getElementById('categoria').value = entry.category;
        document.getElementById('assunto').value = entry.title;
        document.getElementById('descricao').value = entry.description;
        document.getElementById('url').value = entry.url;
        editingId = id;
        document.getElementById('actionType').value = 'replace';
    }

    function deleteEntry(id) {
        if (confirm(`Tem certeza que deseja deletar a entrada com ID: ${id}?`)) {
            delete entries[id];
            displayEntries();
        }
    }

    function reorderEntries(id, newIndex) {
        const currentEntries = Object.keys(entries);
        const oldIndex = currentEntries.indexOf(id);
        if (oldIndex > -1) {
            currentEntries.splice(oldIndex, 1);
            currentEntries.splice(newIndex, 0, id);
            const newEntries = {};
            currentEntries.forEach(key => {
                newEntries[key] = entries[key];
            });
            Object.assign(entries, newEntries);
        }
    }

    function abrirOuFocarJanela(url, title) {
        const left = 300;
        const top = 100;
        const width = 400;
        const height = 600;
        const options = `width=${width},height=${height},top=${top},left=${left}`;
        window.open(url, title, options);
    }
</script>
</body>
</html>
